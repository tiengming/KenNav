<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <title>é¦–é¡µ</title>
  <style>
    /* å…¨å±€æ ·å¼ */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #f6f8fd, #f0f3fa);
      color: #333;
      -webkit-touch-callout: none;  /* ç¦æ­¢é•¿æŒ‰èœå• */
      -webkit-user-select: none;    /* Safari */
      -khtml-user-select: none;     /* Konqueror HTML */
      -moz-user-select: none;       /* Firefox */
      -ms-user-select: none;        /* Internet Explorer/Edge */
      user-select: none;            /* éå‰ç¼€ç‰ˆæœ¬ */
    }

    /* å®¹å™¨æ ·å¼ */
    .container {
      text-align: center;
      backdrop-filter: blur(20px);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.6));
      padding: 1rem;
      width: 100%;
      height: 100vh;
      box-sizing: border-box;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .container::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
      z-index: -1;
    }

    /* æ ‡é¢˜æ ·å¼ */
    h2 {
      font-size: 2rem;
      margin: 1rem 0 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #ff6f61, #48c6ef);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 0.5px;
    }

    /* æ ‡ç­¾å¯¼èˆªæ ·å¼ */
    .tabs-container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
      box-sizing: border-box;
    }

    /* ä¿®æ”¹æ ‡ç­¾å¯¼èˆªæ ·å¼ */
    .tabs {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 0 auto 1rem;
      gap: 0.5rem;
      background: rgba(0, 0, 0, 0.04);
      padding: 0.2rem;
      border-radius: 16px;
      position: relative;
      width: fit-content;
      min-width: 200px;
    }

    /* ç§»é™¤åŸæ¥çš„èƒŒæ™¯æ»‘å— */
    .tabs::before {
      display: none;
    }

    /* ä¿®æ”¹æ ‡ç­¾æ ·å¼ */
    .tab {
      position: relative;
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 12px;
      font-weight: 500;
      color: #666;
      min-width: 70px;
      text-align: center;
      margin: 0.2rem;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      background: transparent;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* é€‰ä¸­çŠ¶æ€æ ·å¼ */
    .tab.active {
      color: #fff;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
    }

    /* æ‚¬åœæ•ˆæœ */
    .tab:hover:not(.active) {
      background: rgba(99, 102, 241, 0.1);
      color: #6366f1;
      transform: translateY(-1px);
    }

    /* ç‚¹å‡»æ•ˆæœ */
    .tab:active {
      transform: translateY(0);
    }

    /* å†…å®¹åŒºåŸŸæ ·å¼ */
    .nav-links-container {
      flex: 1;
      overflow: hidden;  /* æ”¹ä¸º hidden */
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;  /* æ·»åŠ ç›¸å¯¹å®šä½ */
    }

    .content-wrapper {
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;  /* æ·»åŠ æ¨ªå‘éšè— */
      padding-top: 1rem;
    }

    .content {
      display: none;
      padding: 0 1rem 1rem;
      width: 100%;  /* ç¡®ä¿å†…å®¹å®½åº¦ä¸º100% */
      box-sizing: border-box;  /* æ·»åŠ ç›’æ¨¡å‹è®¾ç½® */
      position: absolute;  /* ä½¿ç”¨ç»å¯¹å®šä½ */
      left: 0;
      top: 0;
    }

    .content.active {
      display: block;
      position: relative;  /* æ´»åŠ¨å†…å®¹ä½¿ç”¨ç›¸å¯¹å®šä½ */
    }

    /* æŒ‰é’®ç½‘æ ¼å¸ƒå±€ */
    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      padding: 0 1rem;
      width: 100%;
      box-sizing: border-box;
      overflow: visible;
      height: auto;
    }

    /* æŒ‰é’®æ ·å¼ */
    .button {
      display: inline-flex;
      align-items: center;
      padding: 1rem 1.5rem;
      font-size: 1.05rem;
      color: #fff;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      border: none;
      border-radius: 12px;
      text-decoration: none;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 500;
      width: 100%;
      box-sizing: border-box;
      justify-content: flex-start;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      height: 3rem;
      max-width: 100%;
      padding-right: 1rem;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    .button:hover {
      transform: translateY(-4px) !important;
      box-shadow: 0 8px 24px rgba(99, 102, 241, 0.25);
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
    }

    .button:active {
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.2);
    }

    /* æ·»åŠ æŒ‰é’®å†…å®¹å®¹å™¨ */
    .button span {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-left: 0.5rem;
    }

    /* æ»šåŠ¨æ¡æ ·å¼ */
    .content-wrapper::-webkit-scrollbar {
      width: 6px;
    }

    .content-wrapper::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.15);
      border-radius: 3px;
    }

    .content-wrapper::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.25);
    }

    /* åŠ¨ç”»æ•ˆæœ */
    @keyframes slideInRight {
      from { 
        transform: translateX(30px); 
        opacity: 0; 
      }
      to { 
        transform: translateX(0); 
        opacity: 1; 
      }
    }

    @keyframes slideInLeft {
      from { 
        transform: translateX(-30px); 
        opacity: 0; 
      }
      to { 
        transform: translateX(0); 
        opacity: 1; 
      }
    }

    @keyframes slideOutRight {
      from { 
        transform: translateX(0); 
        opacity: 1; 
      }
      to { 
        transform: translateX(30px); 
        opacity: 0; 
      }
    }

    @keyframes slideOutLeft {
      from { 
        transform: translateX(0); 
        opacity: 1; 
      }
      to { 
        transform: translateX(-30px); 
        opacity: 0; 
      }
    }

    .content[class*="slide-"] {
      display: block;
      animation: 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      width: 100%;  /* ç¡®ä¿åŠ¨ç”»æ—¶å†…å®¹å®½åº¦ä¸º100% */
    }

    .content.slide-in-right { animation-name: slideInRight; }
    .content.slide-in-left { animation-name: slideInLeft; }
    .content.slide-out-right { animation-name: slideOutRight; }
    .content.slide-out-left { animation-name: slideOutLeft; }

    /* å“åº”å¼å¸ƒå±€ */
    @media (max-width: 768px) {
      .container { 
        padding: 0.5rem;
      }
      
      .header {
        padding: 0.5rem;
      }

      .main-content {
        padding: 0.5rem;
        height: calc(100vh - 60px);
      }
      
      .search-container {
        margin-bottom: 1.5rem !important;
      }

      .content-wrapper { 
        height: calc(100vh - 180px);
        margin-top: 0rem;
      }
      
      .button-grid {
        gap: 0.6rem;
        padding: 0.5rem;
      }
      
      .quick-link {
        padding: 0.6rem 1rem;
        height: 2.6rem;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 0.3rem;
      }
      
      .header {
        padding: 0.3rem;
      }

      .main-content {
        padding: 0.3rem !important;
        gap: 0 !important;
      }
      
      .content-wrapper {
        height: calc(100vh - 210px);
        margin-top: 1rem;
        padding-top: 0;
      }

      .button {
        height: 2.7rem;
      }
      
      .button-grid {
        gap: 0.6rem;
        padding: 0.4rem;
      }

      .header-actions {
        gap: 0.4rem;
      }

      .action-button, .header-button {
        padding: 0.4rem;
      }

      .action-button {
        font-size: 0.9rem;
      }

      /* æœç´¢æ¡†æ ·å¼ */
      .search-container {
        padding: 0.2rem !important;
      }

      .search-box {
        padding: 0.6rem;
        padding-left: 0;
        font-size: 0.95rem;
      }

      .search-engine {
        padding: 0.4rem 0.6rem;
      }

      /* ç§»åŠ¨ç«¯æ ‡ç­¾æ ·å¼ */
      .tabs {
        display: none !important;
      }
      
      .mobile-tabs-select {
        display: block !important;
      }
      
      .tabs::before {
        display: none;
      }
    }

    /* ä¿®æ”¹æœç´¢æ¡†å®¹å™¨æ ·å¼ */
    .search-container {
      margin: 0 auto 2rem;
      width: 100%;
      max-width: 800px;
      position: relative;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
      padding: 0.3rem;
      gap: 0.3rem;
    }

    /* æœç´¢å¼•æ“é€‰æ‹©å™¨æ ·å¼ */
    .search-engine {
      order: -1; /* å°†æœç´¢å¼•æ“æŒ‰é’®ç§»åˆ°æœ€å‰é¢ */
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.5rem 0.8rem;
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      flex-shrink: 0;
      min-width: auto;
      border-radius: 8px;
    }

    .search-engine:hover {
      background: rgba(0, 0, 0, 0.05);
      color: #4f46e5;
    }

    /* æœç´¢æ¡†æ ·å¼ */
    .search-box {
      flex: 1;
      padding: 0.8rem;
      padding-left: 0;
      font-size: 1.1rem;
      border: none;
      background: none;
      outline: none;
      min-width: 0; /* å…è®¸è¾“å…¥æ¡†ç¼©å° */
    }

    /* æœç´¢æŒ‰é’®æ ·å¼ */
    .search-button {
      padding: 0.5rem;
      background: none;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #6366f1;
      border-radius: 8px;
      flex-shrink: 0;
    }

    .search-button:hover {
      background: rgba(0, 0, 0, 0.05);
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 480px) {
      .search-container {
        padding: 0.2rem;
        gap: 0.2rem;
      }

      .search-engine {
        padding: 0.4rem 0.6rem;
      }

      .search-box {
        padding: 0.6rem;
        padding-left: 0;
        font-size: 1rem;
      }

      .search-button {
        padding: 0.4rem;
      }

      #currentEngineIcon {
        font-size: 1rem;
      }

      #currentEngineName {
        font-size: 0.9rem;
      }
    }

    #currentEngineIcon {
      font-size: 1.1rem;
    }

    #currentEngineName {
      font-size: 0.95rem;
    }

    /* æœç´¢å¼•æ“ä¸‹æ‹‰èœå• */
    .engine-dropdown {
      position: absolute;
      left: 0.5rem;  /* è°ƒæ•´ä¸‹æ‹‰èœå•ä½ç½® */
      top: calc(100% + 0.5rem);
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 0.5rem;
      display: none;
      z-index: 1000;
      min-width: 150px;
    }

    .engine-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.8rem 1rem;
    }

    .engine-option:hover {
      background: rgba(99, 102, 241, 0.1);
    }

    /* ç¡®ä¿ä¸‹æ‹‰èœå•æ˜¾ç¤º/éšè—çš„æ ·å¼å­˜åœ¨ */
    .engine-dropdown.show {
      display: block;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* æ–°å¢æ ·å¼ */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 2rem;
      width: 100%;
      box-sizing: border-box;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      background: linear-gradient(135deg, #ff6f61, #48c6ef);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .bookmarks-link {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .bookmarks-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
    }

    /* ä¿®æ”¹ä¸»å†…å®¹åŒºåŸŸæ ·å¼ */
    .main-content {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 80px); /* å‡å»headerçš„é«˜åº¦ */
      padding: 1rem 2rem;
      overflow: hidden;
    }

    /* ä¿®æ”¹å¿«é€Ÿè®¿é—®åŒºåŸŸæ ·å¼ */
    .quick-access {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* ä¿®æ”¹å¿«é€Ÿè®¿é—®åˆ—è¡¨çš„å¸ƒå±€æ ·å¼ */
    .quick-links {
      overflow-y: auto;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 0.8rem;
      margin-right: 4px;
      height: 100%; /* ä½¿ç”¨å›ºå®šé«˜åº¦è€Œä¸æ˜¯ flex */
      align-content: start; /* è®©ç½‘æ ¼ä»é¡¶éƒ¨å¼€å§‹æ’åˆ— */
    }

    .quick-access-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      flex-shrink: 0; /* é˜²æ­¢å¤´éƒ¨è¢«å‹ç¼© */
    }

    .quick-access-actions {
      display: flex;
      gap: 0.5rem;
    }

    .action-button {
      padding: 0.5rem;
      background: none;
      border: none;
      cursor: pointer;
      color: #6366f1;
      border-radius: 8px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.2rem;
    }

    .action-button:hover {
      background: rgba(99, 102, 241, 0.1);
      transform: translateY(-2px);
    }

    .action-button span {
      font-size: 0.9rem;
    }

    /* æ·»åŠ æŒ‰é’®å†…å®¹å®¹å™¨ */
    .button-content {
      display: flex;
      align-items: center;
      gap: 0.5rem;  /* å›¾æ ‡å’Œæ–‡å­—ä¹‹é—´çš„é—´è· */
    }

    .edit-text, .done-text {
      font-size: 0.9rem;
      font-weight: 500;
    }

    .action-button svg {
      width: 16px;
      height: 16px;
    }

    .action-button:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-2px);
    }

    .action-button.editing {
      background: rgba(99, 102, 241, 0.2);
    }

    .quick-link {
      display: inline-flex;
      align-items: center;
      padding: 0.8rem 1rem;  /* å‡å°å†…è¾¹è· */
      font-size: 1rem;
      color: #fff;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      border-radius: 12px;
      text-decoration: none;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 500;
      width: 100%;
      box-sizing: border-box;
      justify-content: flex-start;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      height: 2.8rem;  /* å‡å°é«˜åº¦ */
      position: relative;
    }

    .quick-link:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(99, 102, 241, 0.25);
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
    }

    .quick-link-content {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      color: inherit;
      text-decoration: none;
      width: 100%;
    }

    .quick-link-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 1.2rem;
    }

    .quick-link-icon img {
      width: 20px;
      height: 20px;
      object-fit: contain;
    }

    .quick-link-name {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ä¿®æ”¹ç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®çš„æ ·å¼ */
    .edit-action-button {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      transition: all 0.2s ease;
    }

    /* ç¼–è¾‘æŒ‰é’®æ ·å¼ - ä½¿ç”¨è¾ƒæŸ”å’Œçš„è“ç»¿è‰² */
    .edit-action-button.edit {
      background: #0ea5e9;  /* æ˜äº®çš„é’è‰² */
    }

    .edit-action-button.edit:hover {
      background: #0284c7;
    }

    /* åˆ é™¤æŒ‰é’®æ ·å¼ - ä½¿ç”¨è¾ƒæŸ”å’Œçš„ç«ç‘°çº¢ */
    .edit-action-button.delete {
      background: #f43f5e;  /* ç«ç‘°çº¢ */
    }

    .edit-action-button.delete:hover {
      background: #e11d48;
    }

    /* è°ƒæ•´æŒ‰é’®ç»„çš„èƒŒæ™¯ */
    .edit-actions {
      position: absolute;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      display: none;
      gap: 0.4rem;
      padding: 0.3rem;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(8px);
    }

    /* æ·»åŠ è¿™ä¸ªç±»æ¥æ˜¾ç¤ºç¼–è¾‘æŒ‰é’® */
    .quick-link.editing .edit-actions {
      display: flex;
    }

    /* è°ƒæ•´å›¾æ ‡é¢œè‰²å’Œå¤§å° */
    .edit-action-button svg {
      stroke: white;
      stroke-width: 2.2;
      width: 15px;
      height: 15px;
    }

    /* æ·»åŠ æŒ‰é’®é˜´å½±æ•ˆæœ */
    .edit-action-button {
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .edit-action-button:hover {
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
      transform: translateY(-1px);
    }

    /* ä¿®æ”¹å¼¹çª—æ ·å¼ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
    }

    /* ä¿®æ”¹ modal-content æ ·å¼ */
    .modal-content {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      width: 90%;
      max-width: 500px; /* å¢åŠ æœ€å¤§å®½åº¦ */
      max-height: 90vh; /* æ·»åŠ æœ€å¤§é«˜åº¦ */
      overflow-y: auto; /* æ·»åŠ å‚ç›´æ»šåŠ¨ */
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
    }

    /* ç§»åŠ¨ç«¯æ ·å¼è°ƒæ•´ */
    @media (max-width: 768px) {
      .modal {
        padding: 1rem;
      }

      .modal-content {
        width: calc(100% - 2rem);
        max-height: 85vh;
        padding: 1.2rem;
      }

      .header {
        padding: 0.4rem 1rem;
      }
    }

    /* å°å±å¹•æ‰‹æœºæ ·å¼è°ƒæ•´ */
    @media (max-width: 480px) {
      .modal-content {
        width: calc(100% - 2rem);
        padding: 1rem;
      }

      .header {
        padding: 0.4rem 1rem;
      }
    }

    /* å›¾æ ‡è¾“å…¥ç»„æ ·å¼ */
    .icon-input-group {
      display: flex;
      gap: 0.5rem;
    }

    /* Select ç»„ä»¶æ ·å¼ */
    .form-group select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.8rem center;
      background-size: 14px;
      padding: 0.8rem;
      padding-right: 2.5rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      color: #333;
      width: 100%;
      box-sizing: border-box;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .form-group select:hover {
      border-color: #6366f1;
    }

    .form-group select:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
    }

    /* å›¾æ ‡é€‰æ‹©ä¸‹æ‹‰æ¡†ç‰¹æ®Šæ ·å¼ */
    .icon-input-group select {
      width: auto;
      min-width: 100px;
      margin-right: 0.5rem;
    }

    .emoji-picker {
      display: none;
      grid-template-columns: repeat(6, 1fr);
      gap: 0.5rem;
      margin-top: 0.5rem;
      padding: 0.5rem;
      background: #f9fafb;
      border-radius: 8px;
    }

    .emoji-picker.show {
      display: grid;
    }

    .emoji-item {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s ease;
      font-size: 1.2rem;
    }

    .emoji-item:hover {
      background: #f3f4f6;
    }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
    .quick-links::-webkit-scrollbar {
      width: 8px;
    }

    .quick-links::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 4px;
    }

    .quick-links::-webkit-scrollbar-thumb {
      background: rgba(99, 102, 241, 0.3);
      border-radius: 4px;
    }

    .quick-links::-webkit-scrollbar-thumb:hover {
      background: rgba(99, 102, 241, 0.5);
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
      .main-content {
        padding: 1rem;
      }
      
      .quick-links {
        grid-template-columns: 1fr;
        gap: 0.7rem;
        padding: 0.8rem;
      }

      .quick-link {
        height: 3rem;
      }

      .edit-actions {
        padding: 0.4rem;
        gap: 0.5rem;
      }

      .edit-action-button {
        width: 32px;
        height: 32px;
      }
    }

    @media (max-width: 480px) {
      .main-content {
        padding: 0.8rem;
      }
      
      .quick-links {
        gap: 0.6rem;
        padding: 0.6rem;
      }
    }

    /* å³é”®èœå•æ ·å¼ */
    .context-menu {
      position: fixed;
      background: white;
      border-radius: 8px;
      padding: 0.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: none;
      z-index: 1000;
      min-width: 120px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 0.8rem;
      cursor: pointer;
      border-radius: 6px;
      color: #333;
      transition: all 0.2s ease;
    }

    .menu-item:hover {
      background: rgba(99, 102, 241, 0.1);
    }

    .menu-item.delete {
      color: #f43f5e;
    }

    .menu-item.delete:hover {
      background: rgba(244, 63, 94, 0.1);
    }

    /* æ·»åŠ é•¿æŒ‰é«˜äº®æ•ˆæœ */
    .quick-link.active {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
    }

    @media (max-width: 768px) {
      .context-menu {
        min-width: 60px;
      }

      .context-menu.show {
        transform: translateY(0);
      }

      .menu-item {
        justify-content: center;
        font-size: 1.1rem;
      }
    }

    /* ä¿®æ”¹ç¼–è¾‘çŠ¶æ€ä¸‹çš„å¿«é€Ÿè®¿é—®é¡¹æ ·å¼ */
    .quick-link {
      position: relative;
    }

    .edit-actions {
      position: absolute;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      display: none;
      gap: 0.4rem;
      padding: 0.3rem;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(8px);
    }

    .editing .quick-link .edit-actions {
      display: flex;
    }

    /* ç¼–è¾‘æŒ‰é’®æ¿€æ´»çŠ¶æ€ */
    .edit-button.active {
      background: rgba(99, 102, 241, 0.3);
      color: #4f46e5;
    }

    @media (max-width: 768px) {
      .edit-actions {
        padding: 0.4rem;
        gap: 0.5rem;
      }

      .edit-action-button {
        width: 32px;
        height: 32px;
      }
    }

    /* ä¿®æ”¹ç¼–è¾‘æŒ‰é’®å’Œæ“ä½œæŒ‰é’®çš„æ ·å¼ */
    .edit-actions {
      display: none;  /* é»˜è®¤éšè— */
    }

    /* ç§»åŠ¨ç«¯ç¼–è¾‘çŠ¶æ€æ˜¾ç¤ºæŒ‰é’® */
    @media (max-width: 768px) {
      .editing .quick-link .edit-actions {
        display: flex;
      }
    }

    /* PCç«¯å³é”®èœå•æ ·å¼ä¿æŒä¸å˜ */
    .context-menu {
      display: none;
    }

    @media (min-width: 769px) {
      .context-menu {
        position: fixed;
        background: white;
        border-radius: 8px;
        padding: 0.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        min-width: 120px;
      }
    }

    /* ä¿®æ”¹ç¼–è¾‘æŒ‰é’®çš„ HTML ç»“æ„ */
    .edit-button {
      display: none;
    }

    .button-content {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .edit-button .done-content {
      display: none;
    }

    .edit-button.active .edit-content {
      display: none;
    }

    .edit-button.active .done-content {
      display: flex;
    }

    .edit-button span {
      font-size: 0.9rem;
    }

    /* ç¼–è¾‘çŠ¶æ€ä¸‹çš„æ ·å¼ */
    .edit-button.active {
      background: rgba(99, 102, 241, 0.2);
      color: #4f46e5;
    }

    /* æ·»åŠ å¼¹çª—æ˜¾ç¤ºæ ·å¼ */
    .modal.show {
      display: flex;
    }

    /* æ·»åŠ åŸºç¡€è¡¨å•æ ·å¼ */
    .modal-header {
      margin-bottom: 1.5rem;
    }

    .modal-header h3 {
      margin: 0;
      color: #333;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #666;
    }

    .form-group input {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      box-sizing: border-box;
    }

    .modal-footer {
      margin-top: 1rem;
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
    }

    .modal-button {
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .cancel-button {
      background: #f3f4f6;
      color: #666;
    }

    .save-button {
      background: #6366f1;
      color: white;
    }

    .save-button:hover {
      background: #4f46e5;
    }

    .cancel-button:hover {
      background: #e5e7eb;
    }

    /* åˆå¹¶æŒ‰é’®ç›¸å…³çš„åŸºç¡€æ ·å¼ */
    .action-button,
    .edit-action-button,
    .modal-button {
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    /* æ·»åŠ å¤´éƒ¨æŒ‰é’®æ ·å¼ */
    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .header-button {
      padding: 0.5rem;
      border-radius: 8px;
      background: rgba(99, 102, 241, 0.1);
      border: none;
      cursor: pointer;
      color: #6366f1;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header-button:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-2px);
    }

    /* è®¾ç½®å¼¹çª—æ ·å¼ */
    .settings-content {
      padding: 1rem 0;
      flex: 1;
      overflow-y: auto;
    }

    .settings-section {
      margin-bottom: 1.5rem;
    }

    .settings-section h4 {
      margin: 0 0 1rem;
      color: #333;
      font-size: 1rem;
    }

    .settings-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.8rem;
    }

    .settings-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.8rem;
      border: none;
      border-radius: 8px;
      background: rgba(99, 102, 241, 0.1);
      color: #6366f1;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .settings-button:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-2px);
    }

    .settings-button svg {
      flex-shrink: 0;
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 768px) {
      .settings-buttons {
        grid-template-columns: 1fr;
      }
    }

    /* é…ç½®æ–‡æœ¬åŒºåŸŸæ ·å¼ */
    .config-text-area {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      max-height: 300px; /* æ·»åŠ æœ€å¤§é«˜åº¦ */
      overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
    }

    .config-text-area textarea {
      width: 90%;
      width: -webkit-fill-available;
      height: 150px; /* è°ƒæ•´é»˜è®¤é«˜åº¦ */
      max-height: 250px; /* æ·»åŠ æœ€å¤§é«˜åº¦ */
      padding: 0.8rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.9rem;
      resize: vertical;
      background: white;
      overflow-y: auto; /* æ·»åŠ å‚ç›´æ»šåŠ¨ */
      line-height: 1.4; /* æ·»åŠ è¡Œé«˜ */
    }

    .config-text-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.8rem;
    }

    .text-action-button {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.5rem 0.8rem;
      border: none;
      border-radius: 6px;
      background: white;
      color: #6366f1;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .text-action-button:hover {
      background: #f3f4f6;
    }

    .text-action-button svg {
      flex-shrink: 0;
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 480px) {
      .config-text-actions {
        flex-wrap: wrap;
      }
      
      .text-action-button {
        flex: 1;
        min-width: 80px;
        justify-content: center;
      }
    }

    /* æœç´¢å¼•æ“åˆ—è¡¨æ ·å¼ */
    .search-engines-list {
      margin: 1rem 0;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      max-height: 300px;
      overflow-y: auto;
    }

    .search-engine-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem;
      background: #f8f9fa;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .search-engine-info {
      flex: 1;
    }

    .engine-name {
      font-weight: 500;
      margin-bottom: 0.2rem;
    }

    .engine-url {
      font-size: 0.9rem;
      color: #666;
    }

    .engine-actions {
      display: flex;
      gap: 0.5rem;
    }

    .engine-action-button {
      padding: 0.5rem;
      background: none;
      border: none;
      cursor: pointer;
      color: #6366f1;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .engine-action-button:hover {
      background: rgba(99, 102, 241, 0.1);
    }

    .engine-action-button.delete {
      color: #ef4444;
    }

    .engine-action-button.delete:hover {
      background: rgba(239, 68, 68, 0.1);
    }

    /* æ·»åŠ æœç´¢å¼•æ“æŒ‰é’®æ ·å¼ */
    .add-engine-button {
      width: 100%;
      justify-content: center;
      margin-top: 0.5rem;
      padding: 0.8rem;
      gap: 0.5rem;
      background: #f8f9fa;
      color: #6366f1;
      border: 2px dashed #e2e8f0;
      transition: all 0.3s ease;
    }

    .add-engine-button:hover {
      background: #f1f5f9;
      border-color: #6366f1;
    }

    /* è¡¨å•æç¤ºæ–‡æœ¬æ ·å¼ */
    .form-hint {
      font-size: 0.9rem;
      color: #666;
      margin-top: 0.4rem;
    }

    /* ä¿®æ”¹æœç´¢å¼•æ“åˆ—è¡¨é¡¹æ ·å¼ */
    .search-engine-info {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    .engine-name {
      font-weight: 500;
      color: #333;
    }

    .engine-url {
      font-size: 0.85rem;
      color: #666;
      word-break: break-all;
    }

    /* ç§»åŠ¨ç«¯ä¸‹æ‹‰é€‰æ‹©æ ·å¼ */
    .mobile-tabs-select {
      display: none;
      width: 100%;
      padding: 0.8rem;
      font-size: 1rem;
      border: 1px solid rgba(99, 102, 241, 0.2);
      border-radius: 12px;
      background: white;
      color: #333;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.8rem center;
      background-size: 14px;
      cursor: pointer;
    }

    /* ä¿®æ”¹å“åº”å¼å¸ƒå±€ç›¸å…³æ ·å¼ */
    @media (max-width: 480px) {
      .tabs {
        display: none !important; /* å¼ºåˆ¶éšè—æ ‡ç­¾æ  */
      }
      
      .mobile-tabs-select {
        display: block !important; /* å¼ºåˆ¶æ˜¾ç¤ºä¸‹æ‹‰é€‰æ‹© */
      }
      
      /* ç§»é™¤åŸæœ‰çš„æ ‡ç­¾ç›¸å…³æ ·å¼ */
      .tabs::before {
        display: none;
      }
    }

    /* ... existing code ... */
    .settings-button.danger {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    .settings-button.danger:hover {
      background: rgba(239, 68, 68, 0.2);
    }

    /* ä¿®æ”¹ loading åŠ¨ç”»æ ·å¼ */
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-dots {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .loading-dots span {
      width: 4px;
      height: 4px;
      background: currentColor;
      border-radius: 50%;
      animation: dots 1s infinite;
    }

    .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes dots {
      0%, 100% { transform: scale(0.5); opacity: 0.5; }
      50% { transform: scale(1); opacity: 1; }
    }

    /* åˆ†ç»„åˆ—è¡¨æ ·å¼ */
    .categories-list {
      margin-bottom: 1rem;
      background: rgba(0, 0, 0, 0.02);
      border-radius: 12px;
      overflow: hidden;
    }

    .category-item {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 0.2rem;
      padding: 0.4rem 0.4rem 0.4rem 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      background: white;
      transition: background 0.2s;
    }

    .category-item.dragging {
      opacity: 0.5;
      background: #f8fafc;
    }

    .drag-handle {
      cursor: grab;
      color: #94a3b8;
      padding: 0.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .drag-handle:hover {
      color: #64748b;
      background: rgba(0, 0, 0, 0.05);
    }

    .drag-handle:active {
      cursor: grabbing;
    }

    .category-item:last-child {
      border-bottom: none;
    }

    .category-name {
      font-weight: 500;
      color: #333;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .category-actions {
      display: flex;
    }

    .category-action-button {
      padding: 0.4rem;
      background: none;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: #666;
      transition: all 0.2s;
    }

    .category-action-button:hover {
      background: rgba(0, 0, 0, 0.05);
      color: #333;
    }

    .category-action-button.delete:hover {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    .add-category-button {
      width: 100%;
      justify-content: center;
      margin-top: 1rem;
    }

    /* ä¿®æ”¹åˆ†ç»„ç®¡ç†å¼¹çª—æ ·å¼ */
    .modal-content {
      display: flex;
      flex-direction: column;
      max-height: 90vh;
      height: auto;
    }

    /* åˆ†ç»„åˆ—è¡¨å®¹å™¨æ ·å¼ */
    .categories-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* ä¿®æ”¹åˆ—è¡¨åŒ…è£…å™¨æ ·å¼ */
    .categories-list-wrapper {
      flex: 1;
      overflow-y: auto;  /* å…è®¸å‚ç›´æ»šåŠ¨ */
      min-height: 100px;  /* è®¾ç½®æœ€å°é«˜åº¦ */
      max-height: calc(90vh - 200px);  /* é™åˆ¶æœ€å¤§é«˜åº¦ï¼Œå‡å»å¤´éƒ¨ã€åº•éƒ¨å’ŒæŒ‰é’®çš„é«˜åº¦ */
    }

    /* åˆ†ç»„åˆ—è¡¨æ ·å¼ */
    .categories-list {
      margin-bottom: 0;
      background: rgba(0, 0, 0, 0.02);
      border-radius: 12px;
      overflow: hidden;
    }

    /* æ·»åŠ åˆ†ç»„æŒ‰é’®å›ºå®šåœ¨åº•éƒ¨ */
    .categories-section .add-category-button {
      margin-top: 0;  /* ç§»é™¤é¡¶éƒ¨é—´è· */
    }

    /* åˆ†ç»„åˆ—è¡¨æ»šåŠ¨æ¡æ ·å¼ */
    .categories-list-wrapper::-webkit-scrollbar {
      width: 6px;
    }

    .categories-list-wrapper::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.15);
      border-radius: 3px;
    }

    .categories-list-wrapper::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.25);
    }

    /* ä¿®æ”¹æ·»åŠ æŒ‰é’®ç»Ÿä¸€æ ·å¼ */
    .add-button {
      width: 100%;
      justify-content: center;
      margin-top: 0.5rem;
      padding: 0.8rem;
      gap: 0.5rem;
      background: #f8f9fa;
      color: #6366f1;
      border: 2px dashed #e2e8f0;
      transition: all 0.3s ease;
    }

    .add-button:hover {
      background: #f1f5f9;
      border-color: #6366f1;
    }

    /* ç§»é™¤æ—§çš„æ ·å¼ */
    .add-category-button {
      width: 100%;
      justify-content: center;
      margin-top: 0;
    }

    .add-engine-button {
      width: 100%;
      justify-content: center;
      margin-top: 0.5rem;
      padding: 0.8rem;
      gap: 0.5rem;
      background: #f8f9fa;
      color: #6366f1;
      border: 2px dashed #e2e8f0;
      transition: all 0.3s ease;
    }

    /* æ·»åŠ ç§»åŠ¨ç«¯æ‹–åŠ¨ç›¸å…³æ ·å¼ */
    .category-item {
      transition: transform 0.2s;
    }

    .category-item.dragging {
      opacity: 0.9;
      background: #f8fafc;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .drag-handle {
      cursor: grab;
      touch-action: none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      padding: 0.5rem;
    }

    /* ç§»åŠ¨ç«¯æ ·å¼ä¼˜åŒ– */
    @media (max-width: 480px) {
      .drag-handle {
        padding: 0.8rem 0.4rem; /* å¢å¤§è§¦æ‘¸åŒºåŸŸ */
      }
      
      .category-action-button {
        padding: 0.6rem; /* å¢å¤§æŒ‰é’®ç‚¹å‡»åŒºåŸŸ */
      }
    }
  </style>
  <script type="module">
    import { 
      defaultSearchEngines as searchEngines,
      getStoredSearchEngine, 
      saveSearchEngineSelection,
      STORAGE_KEYS,
      bookmarkConfig,
      getBookmarkConfig,
      getSearchEngines,
      getWebDAVConfig,
      saveWebDAVConfig,
      generateId,  // æ·»åŠ  generateId å¯¼å…¥
    } from './config.js';
    
    // å®šä¹‰å…¨å±€å˜é‡
    const DEFAULT_ICON = 'ğŸ”—';

    // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
    function initializeSearch() {
      const searchBox = document.querySelector('.search-box');
      const searchButton = document.querySelector('.search-button');
      const engineButton = document.querySelector('.search-engine');
      const engineDropdown = document.querySelector('.engine-dropdown');
      
      // åˆå§‹åŒ–æœç´¢å¼•æ“ä¸‹æ‹‰èœå•
      initEngineDropdown();
      
      // æ›´æ–°å½“å‰æœç´¢å¼•æ“æ˜¾ç¤º
      updateCurrentEngine();
      
      // æœç´¢æ¡†å›è½¦äº‹ä»¶
      searchBox.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          performSearch();
        }
      });
      
      // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      searchButton.addEventListener('click', performSearch);
      
      // æœç´¢å¼•æ“åˆ‡æ¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      engineButton.addEventListener('click', (e) => {
        e.stopPropagation();
        engineDropdown.classList.toggle('show');
      });
      
      // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
      document.addEventListener('click', () => {
        engineDropdown.classList.remove('show');
      });
    }
    
    // æ‰§è¡Œæœç´¢
    function performSearch() {
      const searchBox = document.querySelector('.search-box');
      const query = searchBox.value.trim();
      if (!query) return;

      const engines = getSearchEngines();
      const currentEngineId = getStoredSearchEngine();
      const engine = engines.find(e => e.id === currentEngineId);
      
      if (engine) {
        const searchUrl = engine.url.replace('{q}', encodeURIComponent(query));
        // ä¿®æ”¹è¿™é‡Œï¼Œç§»é™¤ '_blank'
        window.location.href = searchUrl;
      }
    }

    // åˆå§‹åŒ–æœç´¢å¼•æ“ä¸‹æ‹‰èœå•
      function initEngineDropdown() {
        const dropdown = document.querySelector('.engine-dropdown');
        const engines = getSearchEngines();
        
        dropdown.innerHTML = engines.map(engine => `
        <div class="engine-option" data-id="${engine.id}">
          ${engine.name}
  </div>
        `).join('');
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶
      dropdown.querySelectorAll('.engine-option').forEach(option => {
        option.addEventListener('click', (e) => {
          const engineId = e.currentTarget.dataset.id;
          saveSearchEngineSelection(engineId);
          updateCurrentEngine();
        dropdown.classList.remove('show');
      });
      });
    }
    
    // æ›´æ–°å½“å‰æœç´¢å¼•æ“æ˜¾ç¤º
    function updateCurrentEngine() {
      const currentEngineId = getStoredSearchEngine();
          const engines = getSearchEngines();
      const engine = engines.find(e => e.id === currentEngineId);
      
          if (engine) {
        document.getElementById('currentEngineName').textContent = engine.name;
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', () => {
      initializeSearch();
      initializeBookmarks();
      initializeEventListeners();
    });

    // ä¿®æ”¹å¯¼å‡ºé…ç½®å‡½æ•°
    function exportConfig() {
      const config = {
        searchEngine: getStoredSearchEngine(),
        searchEngines: getSearchEngines(),
        bookmarkConfig: getBookmarkConfig()
      };

      const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `config_${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // ä¿®æ”¹å¯¼å…¥é…ç½®å‡½æ•°
    async function importConfig(file) {
      try {
        const text = await file.text();
        const config = JSON.parse(text);

        // å¯¼å…¥æœç´¢å¼•æ“åˆ—è¡¨
        if (config.searchEngines) {
          localStorage.setItem('searchEngines', JSON.stringify(config.searchEngines));
        }

        // å¯¼å…¥å½“å‰é€‰ä¸­çš„æœç´¢å¼•æ“
        if (config.searchEngine) {
          saveSearchEngineSelection(config.searchEngine);
        }

        // å¯¼å…¥æ”¶è—å¤¹é…ç½®
        if (config.bookmarkConfig) {
          localStorage.setItem(STORAGE_KEYS.BOOKMARK_CONFIG, JSON.stringify(config.bookmarkConfig));
        }

        alert('é…ç½®å¯¼å…¥æˆåŠŸï¼');
        location.reload();
      } catch (error) {
        console.error('å¯¼å…¥é…ç½®å¤±è´¥:', error);
        alert('å¯¼å…¥é…ç½®å¤±è´¥ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼');
      }
    }

    // ä¿®æ”¹å¯¼å‡ºåˆ°æ–‡æœ¬æ¡†å‡½æ•°
    function exportConfigToText() {
      const config = {
        searchEngine: getStoredSearchEngine(),
        searchEngines: getSearchEngines(),
        bookmarkConfig: getBookmarkConfig()
      };
      document.getElementById('configText').value = JSON.stringify(config, null, 2);
    }

    // è¡¨å•éªŒè¯å‡½æ•°
    function validateForm() {
      const name = document.getElementById('linkName').value.trim();
      const url = document.getElementById('linkUrl').value.trim();
      const icon = document.getElementById('linkIcon').value.trim() || DEFAULT_ICON;
      
      if (!name || !url) {
        alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
        return null;
      }

      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„URLåœ°å€');
          return null;
      }

      return { name, url, icon };
    }

    // é‡ç½®è¡¨å•å‡½æ•°
    function resetForm() {
      document.getElementById('linkName').value = '';
      document.getElementById('linkUrl').value = '';
      document.getElementById('linkIcon').value = '';
      document.getElementById('iconType').value = 'emoji';
      document.getElementById('emojiPicker').classList.add('show');
    }

    // åˆå§‹åŒ–æ ‡ç­¾æŒ‡ç¤ºå™¨
    function updateTabIndicator() {
      const activeTab = document.querySelector('.tab.active');
      const tabsContainer = document.querySelector('.tabs');
      if (!activeTab || !tabsContainer) return;
      
      if (window.innerWidth <= 480) {
        // ç§»åŠ¨ç«¯ç«–å‘å¸ƒå±€ä¿æŒä¸å˜
        const tabHeight = activeTab.offsetHeight;
        const tabTop = activeTab.offsetTop;
        const tabs = document.querySelectorAll('.tab');
        const tabCount = tabs.length;
        const slideHeight = (100 / tabCount).toFixed(2);
        
        tabsContainer.style.setProperty('--slide-top', `${tabTop}px`);
        tabsContainer.style.setProperty('--slide-height', `${slideHeight}%`);
        tabsContainer.style.removeProperty('--slide-left');
        tabsContainer.style.removeProperty('--slide-width');
      } else {
        // PCç«¯æ¨ªå‘å¸ƒå±€ï¼ˆæ”¯æŒå¤šè¡Œï¼‰
        const tabWidth = activeTab.offsetWidth || 0;
        const tabHeight = activeTab.offsetHeight || 0;
        const tabLeft = activeTab.offsetLeft || 0;
        const tabTop = activeTab.offsetTop || 0;
        
        // è®¾ç½®æŒ‡ç¤ºå™¨çš„ä½ç½®å’Œå¤§å°
        tabsContainer.style.setProperty('--slide-left', `${tabLeft}px`);
        tabsContainer.style.setProperty('--slide-width', `${tabWidth}px`);
        tabsContainer.style.setProperty('--slide-top', `${tabTop}px`);
        tabsContainer.style.setProperty('--slide-height', `${tabHeight}px`);
      }
    }

    // æ·»åŠ çª—å£å¤§å°å˜åŒ–ç›‘å¬
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(updateTabIndicator, 100);
    });

    // ä¿®æ”¹åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å‡½æ•°
    function initializeEventListeners() {
      // è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('settingsButton').addEventListener('click', () => {
        document.getElementById('settingsModal').classList.add('show');
        // åˆå§‹åŒ–æœç´¢å¼•æ“åˆ—è¡¨
        initSearchEnginesList();
        // æ›´æ–°é…ç½®æ–‡æœ¬æ¡†
        exportConfigToText();
        // åŠ è½½ WebDAV é…ç½®
        loadWebDAVConfig();
      });

      // å…³é—­è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('closeSettingsButton').addEventListener('click', () => {
        document.getElementById('settingsModal').classList.remove('show');
      });

      // æ·»åŠ åˆ†ç»„æŒ‰é’®
      document.getElementById('addCategoryBtn').addEventListener('click', () => {
        document.getElementById('categoryModal').classList.add('show');
        initializeCategoriesList();
      });

      document.getElementById('closeCategoryModal').addEventListener('click', () => {
        document.getElementById('categoryModal').classList.remove('show');
      });

      document.getElementById('addNewCategoryBtn').addEventListener('click', () => {
        document.getElementById('editCategoryModal').classList.add('show');
        // é‡ç½®è¡¨å•
        document.getElementById('editCategoryTitle').textContent = 'æ·»åŠ åˆ†ç»„';
        document.getElementById('categoryName').value = '';
        document.getElementById('categoryId').value = '';
      });

      // æ·»åŠ é“¾æ¥æŒ‰é’®
      document.getElementById('addBookmarkBtn').addEventListener('click', () => {
        updateCategorySelect();
        // åˆå§‹åŒ– emoji picker çš„æ˜¾ç¤ºçŠ¶æ€
        document.getElementById('iconType').value = 'emoji';
        document.getElementById('emojiPicker').classList.add('show');
        document.getElementById('addLinkModal').classList.add('show');
      });

      // å–æ¶ˆæŒ‰é’®
      document.getElementById('cancelCategoryButton').addEventListener('click', () => {
        // ä¿®æ”¹è¿™é‡Œï¼Œä» addCategoryModal æ”¹ä¸º editCategoryModal
        document.getElementById('editCategoryModal').classList.remove('show');
        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById('categoryName').value = '';
        document.getElementById('categoryId').value = '';
      });

      document.getElementById('cancelButton').addEventListener('click', () => {
        document.getElementById('addLinkModal').classList.remove('show');
          resetForm();
      });

      // ä¿å­˜æŒ‰é’®
      document.getElementById('saveCategoryButton').addEventListener('click', saveCategory);
      document.getElementById('saveButton').addEventListener('click', saveBookmark);

      // å›¾æ ‡ç±»å‹åˆ‡æ¢
      document.getElementById('iconType').addEventListener('change', (e) => {
        const emojiPicker = document.getElementById('emojiPicker');
        if (e.target.value === 'emoji') {
          emojiPicker.classList.add('show');
        } else {
          emojiPicker.classList.remove('show');
        }
      });

      // Emoji é€‰æ‹©
      document.querySelectorAll('.emoji-item').forEach(item => {
        item.addEventListener('click', () => {
          document.getElementById('linkIcon').value = item.dataset.emoji;
        });
      });

      // æœç´¢å¼•æ“ç®¡ç†ç›¸å…³äº‹ä»¶
      document.getElementById('addEngineBtn').addEventListener('click', () => {
        document.getElementById('addEngineModal').classList.add('show');
      });

      document.getElementById('cancelEngineButton').addEventListener('click', () => {
        document.getElementById('addEngineModal').classList.remove('show');
        document.getElementById('engineName').value = '';
        document.getElementById('engineUrl').value = '';
      });

      document.getElementById('saveEngineButton').addEventListener('click', addSearchEngine);

      // å¯¼å‡ºé…ç½®æŒ‰é’®
      document.getElementById('exportConfigBtn').addEventListener('click', exportConfig);
      
      // å¯¼å…¥é…ç½®æŒ‰é’®
      document.getElementById('importConfigBtn').addEventListener('click', () => {
        document.getElementById('configFileInput').click();
      });
      
      // æ–‡ä»¶è¾“å…¥æ”¹å˜äº‹ä»¶
      document.getElementById('configFileInput').addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          importConfig(e.target.files[0]);
        }
      });
      
      // é‡ç½®é…ç½®æŒ‰é’®
      document.getElementById('resetConfigBtn').addEventListener('click', resetConfig);
      
      // å¤åˆ¶é…ç½®æŒ‰é’®
      document.getElementById('copyConfigBtn').addEventListener('click', copyConfigText);
      
      // ä»æ–‡æœ¬å¯¼å…¥æŒ‰é’®
      document.getElementById('importFromTextBtn').addEventListener('click', importConfigFromText);
    }

    // ä¿å­˜ä¹¦ç­¾
    function saveBookmark() {
      const formData = validateForm();
      if (!formData) return;

      const categoryId = document.getElementById('bookmarkCategory').value;
      const config = getBookmarkConfig();
      
      const category = config.categories.find(c => c.id === categoryId);
      if (!category) {
        alert('åˆ†ç»„ä¸å­˜åœ¨');
          return;
        }
      
      // æ·»åŠ å”¯ä¸€ID
      formData.id = generateId(categoryId + '_');
      category.links.push(formData);
      localStorage.setItem(STORAGE_KEYS.BOOKMARK_CONFIG, JSON.stringify(config));
      
      // é‡æ–°åŠ è½½é¡µé¢
      location.reload();
    }

    // ç¼–è¾‘ä¹¦ç­¾
    function editBookmark(categoryId, linkId) {
      const config = getBookmarkConfig();
      const category = config.categories.find(c => c.id === categoryId);
      if (!category) return;
      
      const bookmark = category.links.find(link => link.id === linkId);
      if (!bookmark) return;

      // æ›´æ–°åˆ†ç»„é€‰æ‹©ä¸‹æ‹‰æ¡†
      updateCategorySelect();

      // ä¿®æ”¹å¼¹çª—æ ‡é¢˜
      document.querySelector('#addLinkModal .modal-header h3').textContent = 'ç¼–è¾‘é“¾æ¥';

      // å¡«å……è¡¨å•
      document.getElementById('bookmarkCategory').value = categoryId;
      document.getElementById('linkName').value = bookmark.name;
      document.getElementById('linkUrl').value = bookmark.url;
      document.getElementById('linkIcon').value = bookmark.icon;
      
      // æ˜¾ç¤º emoji é¢æ¿
      const iconType = document.getElementById('iconType');
      const emojiPicker = document.getElementById('emojiPicker');
      iconType.value = 'emoji';
      emojiPicker.classList.add('show');
      
      // æ˜¾ç¤ºå¼¹çª—
      document.getElementById('addLinkModal').classList.add('show');

      // ä¿®æ”¹ä¿å­˜æŒ‰é’®è¡Œä¸º
      const saveButton = document.getElementById('saveButton');
      const originalClick = saveButton.onclick;
      saveButton.onclick = () => {
        const formData = validateForm();
        if (!formData) return;

        // è·å–æ–°çš„åˆ†ç»„ID
        const newCategoryId = document.getElementById('bookmarkCategory').value;
        
        // å¦‚æœåˆ†ç»„å‘ç”Ÿå˜åŒ–
        if (newCategoryId !== categoryId) {
          // ä»åŸåˆ†ç»„ä¸­åˆ é™¤
          const linkIndex = category.links.findIndex(link => link.id === linkId);
          if (linkIndex !== -1) {
            category.links.splice(linkIndex, 1);
          }
          
          // æ·»åŠ åˆ°æ–°åˆ†ç»„
          const newCategory = config.categories.find(c => c.id === newCategoryId);
          if (newCategory) {
            formData.id = linkId;  // ä¿æŒåŸæœ‰ID
            newCategory.links.push(formData);
          }
        } else {
          // åœ¨åŸåˆ†ç»„ä¸­æ›´æ–°
          formData.id = linkId;
          const linkIndex = category.links.findIndex(link => link.id === linkId);
          category.links[linkIndex] = formData;
        }

        localStorage.setItem(STORAGE_KEYS.BOOKMARK_CONFIG, JSON.stringify(config));

        // æ¢å¤åŸå§‹ç‚¹å‡»äº‹ä»¶
        saveButton.onclick = originalClick;

        // æ¢å¤å¼¹çª—æ ‡é¢˜
        document.querySelector('#addLinkModal .modal-header h3').textContent = 'æ·»åŠ é“¾æ¥';

        // å…³é—­å¼¹çª—
        document.getElementById('addLinkModal').classList.remove('show');
        resetForm();

        // é‡æ–°åŠ è½½é¡µé¢
        location.reload();
      };
    }

    // åˆ é™¤ä¹¦ç­¾
    function deleteBookmark(categoryId, linkId) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé“¾æ¥å—ï¼Ÿ')) return;

      const config = getBookmarkConfig();
      const category = config.categories.find(c => c.id === categoryId);
      if (!category) return;
      
      const linkIndex = category.links.findIndex(link => link.id === linkId);
      if (linkIndex === -1) return;
      
      category.links.splice(linkIndex, 1);
      localStorage.setItem(STORAGE_KEYS.BOOKMARK_CONFIG, JSON.stringify(config));

      // é‡æ–°åŠ è½½é¡µé¢
      location.reload();
    }

    // ä¿å­˜åˆ†ç»„
    function saveCategory() {
      const nameInput = document.getElementById('categoryName');
      const idInput = document.getElementById('categoryId');
      const name = nameInput.value.trim();
      
      if (!name) {
        alert('è¯·è¾“å…¥åˆ†ç»„åç§°');
        return;
      }
      
      const config = getBookmarkConfig();
      const categoryId = idInput.value;
      
      if (categoryId) {
        // ç¼–è¾‘ç°æœ‰åˆ†ç»„
        const category = config.categories.find(c => c.id === categoryId);
        if (category) {
          category.name = name;
        }
      } else {
        // æ·»åŠ æ–°åˆ†ç»„
        config.categories.push({
          id: generateId(),
          name: name,
          links: []
        });
      }
      
      localStorage.setItem(STORAGE_KEYS.BOOKMARK_CONFIG, JSON.stringify(config));
      document.getElementById('editCategoryModal').classList.remove('show');
      initializeCategoriesList();
      initializeBookmarks(); // åˆ·æ–°ä¸»ç•Œé¢
    }

    // åˆå§‹åŒ–æ ‡ç­¾é¡µå’Œå†…å®¹
    function initializeBookmarks() {
      const currentBookmarkConfig = getBookmarkConfig();
      
      // ç”Ÿæˆæ ‡ç­¾é¡µ
      const tabsContainer = document.querySelector('.tabs');
      const mobileSelect = document.querySelector('.mobile-tabs-select');
      
      // ç”ŸæˆPCç«¯æ ‡ç­¾
      tabsContainer.innerHTML = currentBookmarkConfig.categories.map((category, index) => 
        `<div class="tab${index === 0 ? ' active' : ''}" 
             data-target="${category.id}">
             ${category.name}
         </div>`
      ).join('');
      
      // ç”Ÿæˆç§»åŠ¨ç«¯ä¸‹æ‹‰é€‰æ‹©
      mobileSelect.innerHTML = currentBookmarkConfig.categories.map((category, index) => 
        `<option value="${category.id}"${index === 0 ? ' selected' : ''}>
           ${category.name}
         </option>`
      ).join('');

      // åœ¨ç”Ÿæˆæ ‡ç­¾åç«‹å³æ›´æ–°æ ‡ç­¾æŒ‡ç¤ºå™¨
      requestAnimationFrame(() => {
        updateTabIndicator();
      });

      // ç”Ÿæˆå†…å®¹åŒºåŸŸ
      const contentWrapper = document.querySelector('.content-wrapper');
      contentWrapper.innerHTML = currentBookmarkConfig.categories.map((category, index) => `
        <div class="content${index === 0 ? ' active' : ''}" id="${category.id}">
          <div class="button-grid"></div>
        </div>
      `).join('');

      // ç”Ÿæˆé“¾æ¥æŒ‰é’®
      currentBookmarkConfig.categories.forEach(category => {
        const content = document.getElementById(category.id);
        if (!content) return;
        
        const buttonGrid = content.querySelector('.button-grid');
        buttonGrid.innerHTML = category.links.map(link => `
          <a href="${link.url}" 
             class="button" 
             data-id="${link.id}"
             data-category-id="${category.id}"
             oncontextmenu="showContextMenu(event, this); return false;">
            ${link.icon} <span>${link.name}</span>
          </a>
        `).join('');
      });

      // åˆå§‹åŒ–æ ‡ç­¾äº‹ä»¶
      initializeTabEvents();
    }

    // ä¿®æ”¹ initializeTabEvents å‡½æ•°
    function initializeTabEvents() {
      const tabs = document.querySelectorAll('.tab');
      const contents = document.querySelectorAll('.content');
      const mobileSelect = document.querySelector('.mobile-tabs-select');
      let currentContent = document.querySelector('.content.active');
      let currentTab = document.querySelector('.tab.active');

      // PCç«¯æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
      tabs.forEach((tab) => {
        tab.addEventListener('click', () => {
          switchContent(tab.getAttribute('data-target'));
        });
      });

      // ç§»åŠ¨ç«¯ä¸‹æ‹‰é€‰æ‹©äº‹ä»¶
      mobileSelect.addEventListener('change', (e) => {
        switchContent(e.target.value);
        // è®©ä¸‹æ‹‰æ¡†å¤±ç„¦
        e.target.blur();
      });

      // å†…å®¹åˆ‡æ¢å‡½æ•°
      function switchContent(targetId) {
        const nextContent = document.getElementById(targetId);
        if (currentContent === nextContent) return;

        // æ›´æ–°æ ‡ç­¾çŠ¶æ€
        tabs.forEach(t => t.classList.remove('active'));
        const newTab = Array.from(tabs).find(t => t.getAttribute('data-target') === targetId);
        if (newTab) {
          newTab.classList.add('active');
          updateTabIndicator();
        }

        // æ›´æ–°ä¸‹æ‹‰é€‰æ‹©
        mobileSelect.value = targetId;

        // æ›´æ–°å†…å®¹æ˜¾ç¤º
        const currentIndex = Array.from(contents).indexOf(currentContent);
        const nextIndex = Array.from(contents).indexOf(nextContent);
        const isMovingRight = nextIndex > currentIndex;

        currentContent.style.display = 'block';
        currentContent.classList.add(isMovingRight ? 'slide-out-left' : 'slide-out-right');

        setTimeout(() => {
          contents.forEach(c => {
            c.classList.remove('active', 'slide-out-left', 'slide-out-right', 'slide-in-left', 'slide-in-right');
            c.style.opacity = '';
            c.style.transform = '';
            c.style.display = 'none';
          });

          nextContent.style.display = 'block';
          nextContent.classList.add('active');
          nextContent.classList.add(isMovingRight ? 'slide-in-right' : 'slide-in-left');

          currentContent = nextContent;
          currentTab = newTab;
        }, 300);
      }
    }

    // æ·»åŠ æœç´¢å¼•æ“ç›¸å…³å‡½æ•°
    function initSearchEnginesList() {
      const list = document.querySelector('.search-engines-list');
      const engines = getSearchEngines();
      
      list.innerHTML = engines.map(engine => `
        <div class="search-engine-item" data-id="${engine.id}">
          <div class="search-engine-info">
            <div class="engine-name">${engine.name}</div>
            <div class="engine-url">${engine.url}</div>
          </div>
          <div class="engine-actions">
            <button class="engine-action-button edit" title="ç¼–è¾‘">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </button>
            <button class="engine-action-button delete" title="åˆ é™¤">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18"></path>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
        </div>
      `).join('');

      // ç»‘å®šç¼–è¾‘å’Œåˆ é™¤äº‹ä»¶
      list.querySelectorAll('.engine-action-button').forEach(button => {
        button.addEventListener('click', (e) => {
          const id = e.target.closest('.search-engine-item').dataset.id;
          if (button.classList.contains('edit')) {
            editSearchEngine(id);
          } else if (button.classList.contains('delete')) {
            deleteSearchEngine(id);
          }
      });
    });
    }

    // ä¿®æ”¹æ·»åŠ æœç´¢å¼•æ“å‡½æ•°
    function addSearchEngine() {
      const name = document.getElementById('engineName').value.trim();
      const url = document.getElementById('engineUrl').value.trim();

      if (!name || !url) {
        alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
        return;
      }

      if (!url.includes('{q}')) {
        alert('URL å¿…é¡»åŒ…å« {q} ä½œä¸ºæœç´¢å…³é”®è¯çš„å ä½ç¬¦');
        return;
      }

      const engines = getSearchEngines();
      const id = Date.now().toString(36) + Math.random().toString(36).substr(2);
      
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåæœç´¢å¼•æ“
      if (engines.some(e => e.name.toLowerCase() === name.toLowerCase())) {
        alert('å·²å­˜åœ¨åŒåçš„æœç´¢å¼•æ“');
        return;
      }

      engines.push({ id, name, url });
      localStorage.setItem('searchEngines', JSON.stringify(engines));
      
      document.getElementById('addEngineModal').classList.remove('show');
      initSearchEnginesList();
      initEngineDropdown();
      exportConfigToText(); // æ›´æ–°é…ç½®æ–‡æœ¬
    }

    // ä¿®æ”¹ç¼–è¾‘æœç´¢å¼•æ“å‡½æ•°
    function editSearchEngine(id) {
      const engines = getSearchEngines();
      const engine = engines.find(e => e.id === id);
      if (!engine) return;

      document.getElementById('engineName').value = engine.name;
      document.getElementById('engineUrl').value = engine.url;

      const modal = document.getElementById('addEngineModal');
      modal.classList.add('show');

      // ä¿®æ”¹ä¿å­˜æŒ‰é’®è¡Œä¸º
      const saveButton = document.getElementById('saveEngineButton');
      saveButton.onclick = () => {
        const name = document.getElementById('engineName').value.trim();
        const url = document.getElementById('engineUrl').value.trim();

        if (!name || !url) {
          alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
          return;
        }

        if (!url.includes('{q}')) {
          alert('URL å¿…é¡»åŒ…å« {q} ä½œä¸ºæœç´¢å…³é”®è¯çš„å ä½ç¬¦');
          return;
        }

        // æ£€æŸ¥æ˜¯å¦ä¸å…¶ä»–å¼•æ“é‡å
        if (engines.some(e => e.id !== id && e.name.toLowerCase() === name.toLowerCase())) {
          alert('å·²å­˜åœ¨åŒåçš„æœç´¢å¼•æ“');
          return;
        }

        // æ›´æ–°å¼•æ“ä¿¡æ¯
        const index = engines.findIndex(e => e.id === id);
        engines[index] = { ...engine, name, url };
        localStorage.setItem('searchEngines', JSON.stringify(engines));

        modal.classList.remove('show');
        initSearchEnginesList();
        initEngineDropdown();
        exportConfigToText(); // æ›´æ–°é…ç½®æ–‡æœ¬
        
        // å¦‚æœç¼–è¾‘çš„æ˜¯å½“å‰é€‰ä¸­çš„æœç´¢å¼•æ“ï¼Œæ›´æ–°æ˜¾ç¤º
        const currentEngine = getStoredSearchEngine();
        if (id === currentEngine) {
          updateEngineIcon();
        }
      };
    }

    // ä¿®æ”¹åˆ é™¤æœç´¢å¼•æ“å‡½æ•°
    function deleteSearchEngine(id) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæœç´¢å¼•æ“å—ï¼Ÿ')) return;
      
      const engines = getSearchEngines();
      const engine = engines.find(e => e.id === id);
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ä½¿ç”¨çš„æœç´¢å¼•æ“
      const currentEngine = getStoredSearchEngine();
      if (id === currentEngine) {
        alert('æ— æ³•åˆ é™¤å½“å‰æ­£åœ¨ä½¿ç”¨çš„æœç´¢å¼•æ“');
        return;
      }
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯é»˜è®¤å¼•æ“
      if (engine.isDefault) {
        alert('æ— æ³•åˆ é™¤é»˜è®¤æœç´¢å¼•æ“');
        return;
      }

      const newEngines = engines.filter(e => e.id !== id);
      localStorage.setItem('searchEngines', JSON.stringify(newEngines));
      initSearchEnginesList();
      initEngineDropdown();
      // æ›´æ–°é…ç½®æ–‡æœ¬
      exportConfigToText();
    }

    // å°†å‡½æ•°è®¾ä¸ºå…¨å±€å¯è®¿é—®
    window.deleteSearchEngine = deleteSearchEngine;

    // æ·»åŠ é‡ç½®é…ç½®å‡½æ•°
    function resetConfig() {
      if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰è®¾ç½®ï¼ŒåŒ…æ‹¬æœç´¢å¼•æ“ã€å¿«é€Ÿè®¿é—®é“¾æ¥ç­‰ã€‚')) {
        // æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨
        localStorage.clear();
        
        alert('é…ç½®å·²é‡ç½®ï¼Œé¡µé¢å°†åˆ·æ–°ã€‚');
        location.reload();
      }
    }

    // å°†å‡½æ•°è®¾ä¸ºå…¨å±€å¯è®¿é—®
    window.resetConfig = resetConfig;

    // æ·»åŠ  loading æ§åˆ¶å‡½æ•°
    function setButtonLoading(button, isLoading, originalText) {
      if (isLoading) {
        button.disabled = true;
        button.classList.add('loading');
        // ä¿å­˜åŸå§‹å†…å®¹
        button.dataset.originalHtml = button.innerHTML;
        button.innerHTML = `
          <div class="button-content">
            <div class="loading-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <span>å¤„ç†ä¸­...</span>
          </div>
        `;
      } else {
        button.disabled = false;
        button.classList.remove('loading');
        // æ¢å¤åŸå§‹å†…å®¹
        button.innerHTML = button.dataset.originalHtml;
      }
    }

    // ä»æ–‡æœ¬å¯¼å…¥é…ç½®
    async function importConfigFromText() {
      try {
        const configText = document.getElementById('configText').value.trim();
        if (!configText) {
          alert('è¯·å…ˆè¾“å…¥é…ç½®æ–‡æœ¬');
          return;
        }
        const config = JSON.parse(configText);
        await importConfig(new Blob([configText], { type: 'application/json' }));
      } catch (error) {
        console.error('å¯¼å…¥é…ç½®å¤±è´¥:', error);
        alert('å¯¼å…¥é…ç½®å¤±è´¥ï¼Œè¯·ç¡®ä¿æ–‡æœ¬æ ¼å¼æ­£ç¡®ï¼');
      }
    }

    // å¤åˆ¶é…ç½®æ–‡æœ¬
    function copyConfigText() {
      const configText = document.getElementById('configText').value;
      try {
        // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸ
        const tempTextArea = document.createElement('textarea');
        tempTextArea.value = configText;
        document.body.appendChild(tempTextArea);
        
        // é€‰æ‹©æ–‡æœ¬
        tempTextArea.select();
        tempTextArea.setSelectionRange(0, 99999); // å…¼å®¹ç§»åŠ¨è®¾å¤‡
        
        // å¤åˆ¶
        document.execCommand('copy');
        
        // ç§»é™¤ä¸´æ—¶å…ƒç´ 
        document.body.removeChild(tempTextArea);
        
        alert('é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      } catch (err) {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
      }
    }

    // ä»å‰ªè´´æ¿ç²˜è´´
    async function pasteConfig() {
      try {
        const text = await navigator.clipboard.readText();
        document.getElementById('configText').value = text;
      } catch (err) {
        console.error('ç²˜è´´å¤±è´¥:', err);
        alert('ç²˜è´´å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ç²˜è´´');
      }
    }

    // æ˜¾ç¤ºå³é”®èœå•
    function showContextMenu(e, link) {
      e.preventDefault();
      const id = link.dataset.id;
      const categoryId = link.dataset.categoryId;  // ä¿®æ”¹ä¸º categoryId

      // è®¾ç½®èœå•ä½ç½®
      const menu = document.getElementById('quickLinkMenu');
      const rect = link.getBoundingClientRect();
      const x = e.clientX;
      const y = e.clientY;

      // ç¡®ä¿èœå•ä¸ä¼šè¶…å‡ºè§†çª—
      const menuWidth = 150;
      const menuHeight = 100;
      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;

      menu.style.left = `${Math.min(x, windowWidth - menuWidth)}px`;
      menu.style.top = `${Math.min(y, windowHeight - menuHeight)}px`;
      menu.style.display = 'block';

      // ç»‘å®šèœå•é¡¹ç‚¹å‡»äº‹ä»¶
      const editItem = menu.querySelector('.menu-item.edit');
      const deleteItem = menu.querySelector('.menu-item.delete');

      editItem.onclick = () => {
        editBookmark(categoryId, id);  // ä½¿ç”¨ categoryId
        menu.style.display = 'none';
      };

      deleteItem.onclick = () => {
        deleteBookmark(categoryId, id);  // ä½¿ç”¨ categoryId
        menu.style.display = 'none';
      };

      // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•
      const closeMenu = (e) => {
        if (!menu.contains(e.target)) {
          menu.style.display = 'none';
          document.removeEventListener('click', closeMenu);
        }
      };

      // å»¶è¿Ÿæ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œé¿å…ç«‹å³è§¦å‘
      setTimeout(() => {
        document.addEventListener('click', closeMenu);
      }, 0);
    }

    // å°†å‡½æ•°è®¾ä¸ºå…¨å±€å¯è®¿é—®
    window.showContextMenu = showContextMenu;
    window.editBookmark = editBookmark;
    window.deleteBookmark = deleteBookmark;

    // æ›´æ–°åˆ†ç»„é€‰æ‹©ä¸‹æ‹‰æ¡†
    function updateCategorySelect() {
      const select = document.getElementById('bookmarkCategory');
      const config = getBookmarkConfig();
      select.innerHTML = config.categories.map(category => 
        `<option value="${category.id}">${category.name}</option>`
      ).join('');
    }

    // ä¿®æ”¹ backupToWebDAV å‡½æ•°
    async function backupToWebDAV() {
      const button = document.getElementById('backupToWebDAVBtn');
      const originalHtml = button.innerHTML;

      // è·å–å®æ—¶è¾“å…¥çš„ WebDAV é…ç½®
      const url = document.getElementById('webdavUrl').value.trim();
      const username = document.getElementById('webdavUsername').value.trim();
      const password = document.getElementById('webdavPassword').value.trim();
      const filename = document.getElementById('webdavFilename').value.trim() || 'nav_backup.json';

      if (!url || !username || !password) {
        alert('è¯·å¡«å†™æ‰€æœ‰ WebDAV é…ç½®é¡¹');
        return;
      }

      // ä¿å­˜æˆåŠŸçš„é…ç½®ï¼ŒåŒ…æ‹¬æ–‡ä»¶å
      await saveWebDAVConfig({ url, username, password, filename });

      setButtonLoading(button, true);

      try {
        const backupData = {
          searchEngine: getStoredSearchEngine(),
          searchEngines: getSearchEngines(),
          bookmarkConfig: getBookmarkConfig(),
          timestamp: new Date().toISOString()
        };

        const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });

        const response = await fetch(`${url}/${filename}`, {
          method: 'PUT',
          headers: {
            'Authorization': 'Basic ' + btoa(username + ':' + password),
            'Content-Type': 'application/json'
          },
          body: blob
        });

        if (response.ok) {
          if (response.status === 201) {
            alert('å¤‡ä»½æˆåŠŸï¼\nå¤‡ä»½æ—¶é—´ï¼š' + new Date().toLocaleString());
          } else {
            alert('å¤‡ä»½å¯èƒ½ä¸æˆåŠŸï¼Œè¯·åˆ° WebDAV æ ¸å®ï¼\nå¤‡ä»½æ—¶é—´ï¼š' + new Date().toLocaleString());
          }
        } else {
          alert('å¤‡ä»½å¤±è´¥ï¼š' + response.statusText);
        }
      } catch (error) {
        alert('å¤‡ä»½å¤±è´¥ï¼š' + error.message);
      } finally {
        setButtonLoading(button, false, originalHtml);
      }
    }

    // ä¿®æ”¹ restoreFromWebDAV å‡½æ•°
    async function restoreFromWebDAV() {
      const button = document.getElementById('restoreFromWebDAVBtn');
      const originalHtml = button.innerHTML;

      // è·å–å®æ—¶è¾“å…¥çš„ WebDAV é…ç½®
      const url = document.getElementById('webdavUrl').value.trim();
      const username = document.getElementById('webdavUsername').value.trim();
      const password = document.getElementById('webdavPassword').value.trim();
      const filename = document.getElementById('webdavFilename').value.trim() || 'nav_backup.json';

      if (!url || !username || !password) {
        alert('è¯·å¡«å†™æ‰€æœ‰ WebDAV é…ç½®é¡¹');
        return;
      }

      // ä¿å­˜æˆåŠŸçš„é…ç½®ï¼ŒåŒ…æ‹¬æ–‡ä»¶å
      await saveWebDAVConfig({ url, username, password, filename });

      setButtonLoading(button, true);

      try {
        const backupResponse = await fetch(`${url}/${filename}`, {
          headers: {
            'Authorization': 'Basic ' + btoa(username + ':' + password)
          }
        });

        if (backupResponse.status === 404) {
          throw new Error('æœªæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶');
        }

        if (!backupResponse.ok) {
          throw new Error('è·å–å¤‡ä»½æ–‡ä»¶å¤±è´¥');
        }

        const backupData = await backupResponse.json();
        
        if (!backupData.timestamp) {
          throw new Error('å¤‡ä»½æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
        }

        // æ˜¾ç¤ºå¤‡ä»½æ—¶é—´å¹¶ç¡®è®¤æ¢å¤
        const backupTime = new Date(backupData.timestamp).toLocaleString();
        if (!confirm(`ç¡®å®šè¦æ¢å¤ä»¥ä¸‹å¤‡ä»½å—ï¼Ÿ\nå¤‡ä»½æ—¶é—´ï¼š${backupTime}`)) {
          setButtonLoading(button, false, originalHtml);
          return;
        }
        
        // æ¢å¤é…ç½®
        if (backupData.searchEngines) {
          localStorage.setItem('searchEngines', JSON.stringify(backupData.searchEngines));
        }
        if (backupData.searchEngine) {
          localStorage.setItem('selectedSearchEngine', backupData.searchEngine);
        }
        if (backupData.bookmarkConfig) {
          localStorage.setItem(STORAGE_KEYS.BOOKMARK_CONFIG, JSON.stringify(backupData.bookmarkConfig));
        }

        alert('æ¢å¤æˆåŠŸï¼Œé¡µé¢å°†åˆ·æ–°ï¼');
        location.reload();
      } catch (error) {
        alert('æ¢å¤å¤±è´¥ï¼š' + error.message);
        setButtonLoading(button, false, originalHtml);
      }
    }

    // ä¿®æ”¹äº‹ä»¶ç›‘å¬
    document.getElementById('backupToWebDAVBtn').addEventListener('click', backupToWebDAV);
    document.getElementById('restoreFromWebDAVBtn').addEventListener('click', restoreFromWebDAV);

    // æ·»åŠ åŠ è½½ WebDAV é…ç½®çš„å‡½æ•°
    async function loadWebDAVConfig() {
      const config = await getWebDAVConfig();
      if (config) {
        try {
          const { url, username, password, filename } = config;
          document.getElementById('webdavUrl').value = url || '';
          document.getElementById('webdavUsername').value = username || '';
          document.getElementById('webdavPassword').value = password || '';
          document.getElementById('webdavFilename').value = filename || 'nav_backup.json';
        } catch (error) {
          console.error('åŠ è½½ WebDAV é…ç½®å¤±è´¥:', error);
        }
      }
    }

    // åˆå§‹åŒ–åˆ†ç»„åˆ—è¡¨
    function initializeCategoriesList() {
      const config = getBookmarkConfig();
      const categoriesList = document.querySelector('.categories-list');
      
      categoriesList.innerHTML = config.categories.map(category => `
        <div class="category-item" data-id="${category.id}" draggable="true">
          <div class="drag-handle">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <circle cx="4" cy="4" r="1.5"/>
              <circle cx="4" cy="8" r="1.5"/>
              <circle cx="4" cy="12" r="1.5"/>
              <circle cx="12" cy="4" r="1.5"/>
              <circle cx="12" cy="8" r="1.5"/>
              <circle cx="12" cy="12" r="1.5"/>
            </svg>
          </div>
          <span class="category-name">${category.name}</span>
          <div class="category-actions">
            <button class="category-action-button edit" onclick="editCategory('${category.id}')">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"></path>
                <polygon points="18 2 22 6 12 16 8 16 8 12 18 2"></polygon>
              </svg>
            </button>
            <button class="category-action-button delete" onclick="deleteCategory('${category.id}')">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
        </div>
      `).join('');

      // æ·»åŠ æ‹–æ‹½æ’åºåŠŸèƒ½
      initializeDragSort(categoriesList);
    }

    // ä¿®æ”¹ initializeDragSort å‡½æ•°ï¼Œæ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
    function initializeDragSort(container) {
      let draggedItem = null;
      let touchStartY = 0;
      let initialY = 0;
      let items = [];
      let itemHeight = 0;

      container.querySelectorAll('.category-item').forEach(item => {
        // PCç«¯æ‹–æ‹½äº‹ä»¶
        item.addEventListener('dragstart', (e) => {
          draggedItem = item;
          setTimeout(() => item.classList.add('dragging'), 0);
        });

        item.addEventListener('dragend', () => {
          item.classList.remove('dragging');
          draggedItem = null;
          saveNewOrder(container);
        });

        item.addEventListener('dragover', (e) => {
          e.preventDefault();
          if (!draggedItem) return;
          handleDragOver(e.clientY, item);
        });

        // ä¿®æ”¹ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶
        item.querySelector('.drag-handle').addEventListener('touchstart', (e) => {
          e.preventDefault();
          draggedItem = item;
          items = Array.from(container.querySelectorAll('.category-item'));
          itemHeight = draggedItem.offsetHeight;
          
          const touch = e.touches[0];
          touchStartY = touch.clientY;
          initialY = draggedItem.getBoundingClientRect().top;
          
          draggedItem.classList.add('dragging');
          draggedItem.style.position = 'fixed';
          draggedItem.style.left = '0';
          draggedItem.style.right = '0';
          draggedItem.style.top = `${initialY}px`;
          draggedItem.style.zIndex = '1000';
          draggedItem.style.margin = '0 1rem';
        });

        item.querySelector('.drag-handle').addEventListener('touchmove', (e) => {
          if (!draggedItem) return;
          e.preventDefault();
          
          const touch = e.touches[0];
          const currentY = touch.clientY;
          const yOffset = currentY - touchStartY;
          
          // ç§»åŠ¨å½“å‰é¡¹
          draggedItem.style.top = `${initialY + yOffset}px`;
          
          // è®¡ç®—å½“å‰æ‹–åŠ¨é¡¹çš„ä¸­å¿ƒä½ç½®
          const draggedRect = draggedItem.getBoundingClientRect();
          const draggedCenter = draggedRect.top + draggedRect.height / 2;
          
          // è·å–æ‰€æœ‰å…¶ä»–é¡¹çš„ä½ç½®ä¿¡æ¯
          const itemPositions = items.map((item, index) => ({
            item,
            index,
            rect: item.getBoundingClientRect(),
            center: item.getBoundingClientRect().top + item.getBoundingClientRect().height / 2
          }));
          
          // æ‰¾åˆ°æœ€è¿‘çš„ç›®æ ‡ä½ç½®
          const draggedIndex = items.indexOf(draggedItem);
          let targetIndex = draggedIndex;
          
          itemPositions.forEach(({ item, index, center }) => {
            if (item === draggedItem) return;
            
            if (draggedCenter < center && index < draggedIndex) {
              targetIndex = Math.min(targetIndex, index);
            } else if (draggedCenter > center && index > draggedIndex) {
              targetIndex = Math.max(targetIndex, index);
            }
          });
          
          // æ›´æ–°å…¶ä»–é¡¹çš„ä½ç½®
          items.forEach((item, index) => {
            if (item === draggedItem) return;
            
            let newPosition = index;
            if (index >= Math.min(targetIndex, draggedIndex) && 
                index <= Math.max(targetIndex, draggedIndex)) {
              if (targetIndex > draggedIndex) {
                newPosition = index - 1;
              } else if (targetIndex < draggedIndex) {
                newPosition = index + 1;
              }
            }
            
            const translateY = (newPosition - index) * itemHeight;
            item.style.transform = `translateY(${translateY}px)`;
            item.style.transition = 'transform 0.2s';
          });
          
          // æ›´æ–°æ•°ç»„é¡ºåº
          if (targetIndex !== draggedIndex) {
            items.splice(draggedIndex, 1);
            items.splice(targetIndex, 0, draggedItem);
          }
        });

        item.querySelector('.drag-handle').addEventListener('touchend', (e) => {
          if (!draggedItem) return;
          
          // é‡ç½®æ‰€æœ‰é¡¹çš„æ ·å¼
          items.forEach(item => {
            item.style.transform = '';
            item.style.transition = '';
          });
          
          draggedItem.style.position = '';
          draggedItem.style.left = '';
          draggedItem.style.right = '';
          draggedItem.style.top = '';
          draggedItem.style.zIndex = '';
          draggedItem.style.margin = '';
          draggedItem.classList.remove('dragging');
          
          // é‡æ–°æ’åº DOM
          items.forEach(item => container.appendChild(item));
          
          // ä¿å­˜æ–°é¡ºåº
          saveNewOrder(container);
          draggedItem = null;
        });
      });

      // å¤„ç†æ‹–åŠ¨æ’åºçš„é€šç”¨å‡½æ•°
      function handleDragOver(clientY, item) {
        if (!draggedItem) return;
        
        const box = item.getBoundingClientRect();
        const offsetY = clientY - box.top - box.height / 2;
        
        if (offsetY < 0 && item.previousElementSibling !== draggedItem) {
          item.parentNode.insertBefore(draggedItem, item);
        } else if (offsetY > 0 && item.nextElementSibling !== draggedItem) {
          item.parentNode.insertBefore(draggedItem, item.nextElementSibling);
        }
      }

      // ä¿å­˜æ–°é¡ºåºçš„é€šç”¨å‡½æ•°
      function saveNewOrder(container) {
        const newOrder = Array.from(container.children).map(item => item.dataset.id);
        const config = getBookmarkConfig();
        
        // é‡æ–°æ’åºåˆ†ç»„
        config.categories.sort((a, b) => {
          return newOrder.indexOf(a.id) - newOrder.indexOf(b.id);
        });
        
        localStorage.setItem(STORAGE_KEYS.BOOKMARK_CONFIG, JSON.stringify(config));
        initializeBookmarks(); // åˆ·æ–°ä¸»ç•Œé¢
      }
    }

    // æ˜¾ç¤ºç¼–è¾‘åˆ†ç»„å¼¹çª—
    function showEditCategoryModal(categoryId = null) {
      const modal = document.getElementById('editCategoryModal');
      const title = document.getElementById('editCategoryTitle');
      const nameInput = document.getElementById('categoryName');
      const idInput = document.getElementById('categoryId');
      
      if (categoryId) {
        const config = getBookmarkConfig();
        const category = config.categories.find(c => c.id === categoryId);
        if (category) {
          title.textContent = 'ç¼–è¾‘åˆ†ç»„';
          nameInput.value = category.name;
          idInput.value = categoryId;
        }
      } else {
        title.textContent = 'æ·»åŠ åˆ†ç»„';
        nameInput.value = '';
        idInput.value = '';
      }
      
      modal.classList.add('show');
    }

    // ç¼–è¾‘åˆ†ç»„
    function editCategory(categoryId) {
      const config = getBookmarkConfig();
      const category = config.categories.find(c => c.id === categoryId);
      
      if (category) {
        const modal = document.getElementById('editCategoryModal');
        const title = document.getElementById('editCategoryTitle');
        const nameInput = document.getElementById('categoryName');
        const idInput = document.getElementById('categoryId');
        
        title.textContent = 'ç¼–è¾‘åˆ†ç»„';
        nameInput.value = category.name;
        idInput.value = categoryId;
        
        modal.classList.add('show');
      }
    }

    // åˆ é™¤åˆ†ç»„
    function deleteCategory(categoryId) {
      const config = getBookmarkConfig();
      const category = config.categories.find(c => c.id === categoryId);
      
      if (!category) return;
      
      if (category.links.length > 0) {
        if (!confirm(`ç¡®å®šè¦åˆ é™¤åˆ†ç»„"${category.name}"å—ï¼Ÿ\nè¯¥åˆ†ç»„ä¸­çš„æ‰€æœ‰é“¾æ¥ä¹Ÿä¼šè¢«åˆ é™¤ã€‚`)) {
          return;
        }
      } else {
        if (!confirm(`ç¡®å®šè¦åˆ é™¤åˆ†ç»„"${category.name}"å—ï¼Ÿ`)) {
          return;
        }
      }
      
      config.categories = config.categories.filter(c => c.id !== categoryId);
      localStorage.setItem(STORAGE_KEYS.BOOKMARK_CONFIG, JSON.stringify(config));
      initializeCategoriesList();
      initializeBookmarks(); // åˆ·æ–°ä¸»ç•Œé¢
    }

    // å°†å‡½æ•°è®¾ä¸ºå…¨å±€å¯è®¿é—®
    window.editCategory = editCategory;
    window.deleteCategory = deleteCategory;
  </script>
</head>

<body>
  <div class="container">
    <header class="header">
      <div class="logo"></div>
      <div class="header-actions">
        <button class="action-button" id="addCategoryBtn" title="åˆ†ç»„ç®¡ç†">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"></path>
            <path d="M3 12h18"></path>
            <path d="M3 18h18"></path>
            <line x1="12" y1="3" x2="12" y2="21"></line>
          </svg>
          <span>åˆ†ç»„ç®¡ç†</span>
        </button>
        <button class="action-button" id="addBookmarkBtn" title="æ·»åŠ é“¾æ¥">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          <span>æ·»åŠ é“¾æ¥</span>
        </button>
        <button class="header-button" id="settingsButton" title="è®¾ç½®">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06-.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </button>
      </div>
    </header>

    <main class="main-content">
      <div class="search-container">
        <input type="text" class="search-box" placeholder="è¾“å…¥å…³é”®è¯æœç´¢...">
        <button class="search-engine">
          <span id="currentEngineIcon">ğŸŒ</span>
          <span id="currentEngineName"></span>
        </button>
        <button class="search-button">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </button>
        <div class="engine-dropdown"></div>
      </div>

      <!-- æ·»åŠ åˆ†ç»„æ ‡ç­¾å¯¼èˆª -->
      <div class="tabs-container">
        <div class="tabs"></div>
        <select class="mobile-tabs-select" style="display: none;">
          <!-- å°†ç”± JavaScript åŠ¨æ€å¡«å…… -->
        </select>
      </div>

      <div class="nav-links-container">
        <div class="content-wrapper">
          <!-- å†…å®¹åŒºåŸŸå°†ç”± JavaScript åŠ¨æ€ç”Ÿæˆ -->
              </div>
          </div>
    </main>
        </div>

  <!-- ä¿®æ”¹æ·»åŠ é“¾æ¥å¼¹çª— -->
  <div class="modal" id="addLinkModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>æ·»åŠ é“¾æ¥</h3>
      </div>
      <div class="form-group">
        <label>é€‰æ‹©åˆ†ç»„</label>
        <select id="bookmarkCategory">
          <!-- åŠ¨æ€å¡«å……åˆ†ç»„é€‰é¡¹ -->
        </select>
      </div>
      <div class="form-group">
        <label>åç§°</label>
        <input type="text" id="linkName" maxlength="12" placeholder="ç½‘ç«™åç§°">
      </div>
      <div class="form-group">
        <label>é“¾æ¥</label>
        <input type="url" id="linkUrl" placeholder="http(s)://">
      </div>
      <div class="form-group">
        <label>å›¾æ ‡</label>
        <div class="icon-input-group">
          <select id="iconType">
            <option value="emoji">Emoji</option>
            <option value="url">é“¾æ¥</option>
          </select>
          <input type="text" id="linkIcon" placeholder="è¾“å…¥ Emoji æˆ–å›¾ç‰‡é“¾æ¥">
        </div>
        <div class="emoji-picker" id="emojiPicker">
          <!-- å¸¸ç”¨ emoji åˆ—è¡¨ -->
          <div class="emoji-item" data-emoji="ğŸ”—">ğŸ”—</div>
          <div class="emoji-item" data-emoji="ğŸ“">ğŸ“</div>
          <div class="emoji-item" data-emoji="ğŸŒ">ğŸŒ</div>
          <div class="emoji-item" data-emoji="ğŸ“‚">ğŸ“‚</div>
          <div class="emoji-item" data-emoji="ğŸ®">ğŸ®</div>
          <div class="emoji-item" data-emoji="ğŸ¬">ğŸ¬</div>
          <div class="emoji-item" data-emoji="ğŸ“º">ğŸ“º</div>
          <div class="emoji-item" data-emoji="ğŸµ">ğŸµ</div>
          <div class="emoji-item" data-emoji="ğŸ“š">ğŸ“š</div>
          <div class="emoji-item" data-emoji="â­">â­</div>
          <div class="emoji-item" data-emoji="ğŸ”§">ğŸ”§</div>
          <div class="emoji-item" data-emoji="ğŸœ">ğŸœ</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-button cancel-button" id="cancelButton">å–æ¶ˆ</button>
        <button class="modal-button save-button" id="saveButton">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <div class="context-menu" id="quickLinkMenu">
    <div class="menu-item edit">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
      </svg>
      <span>ç¼–è¾‘</span>
    </div>
    <div class="menu-item delete">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 6h18"></path>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
        <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      </svg>
      <span>åˆ é™¤</span>
    </div>
  </div>

  <!-- æ·»åŠ æ–‡ä»¶è¾“å…¥ï¼ˆéšè—ï¼‰ -->
  <input type="file" id="configFileInput" accept=".json" style="display: none;">

  <!-- æ·»åŠ è®¾ç½®å¼¹çª— -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>è®¾ç½®</h3>
      </div>
      <div class="settings-content">
        <!-- åœ¨è®¾ç½®å¼¹çª—ä¸­æ·»åŠ æœç´¢å¼•æ“ç®¡ç†éƒ¨åˆ† -->
        <div class="settings-section">
          <h4>æœç´¢å¼•æ“ç®¡ç†</h4>
          <div class="search-engines-list">
            <!-- æœç´¢å¼•æ“åˆ—è¡¨å°†ç”± JavaScript åŠ¨æ€ç”Ÿæˆ -->
          </div>
          <button class="settings-button add-button" id="addEngineBtn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span>æ·»åŠ æœç´¢å¼•æ“</span>
          </button>
        </div>

        <div class="settings-section">
          <h4>æ•°æ®ç®¡ç†</h4>
          <div class="settings-buttons">
            <button class="settings-button" id="exportConfigBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              <span>å¯¼å‡ºåˆ°æ–‡ä»¶</span>
            </button>
            <button class="settings-button" id="importConfigBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              <span>ä»æ–‡ä»¶å¯¼å…¥</span>
            </button>
            <button class="settings-button danger" id="resetConfigBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3h18v18H3z"/>
                <path d="M15 9l-6 6M9 9l6 6"/>
              </svg>
              <span>é‡ç½®é…ç½®</span>
            </button>
          </div>
        </div>
        
        <div class="settings-section">
          <h4>é…ç½®æ–‡æœ¬</h4>
          <div class="config-text-area">
            <textarea id="configText" placeholder="åœ¨æ­¤å¤„ç²˜è´´é…ç½®æ–‡æœ¬..."></textarea>
            <div class="config-text-actions">
              <button class="text-action-button" id="copyConfigBtn" title="å¤åˆ¶é…ç½®">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                <span>å¤åˆ¶</span>
              </button>
              <button class="text-action-button" id="importFromTextBtn" title="ä»æ–‡æœ¬å¯¼å…¥">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                </svg>
                <span>å¯¼å…¥</span>
              </button>
            </div>
          </div>
        </div>

        <!-- åœ¨è®¾ç½®å¼¹çª—ä¸­æ·»åŠ  WebDAV é…ç½®éƒ¨åˆ† -->
        <div class="settings-section">
          <h4>WebDAV å¤‡ä»½</h4>
          <div class="form-group">
            <label>æœåŠ¡å™¨åœ°å€ï¼ˆæ–‡ä»¶å¤¹è·¯å¾„ï¼‰</label>
            <input type="url" id="webdavUrl" placeholder="https://dav.example.com/dav/path">
          </div>
          <div class="form-group">
            <label>ç”¨æˆ·å</label>
            <input type="text" id="webdavUsername">
          </div>
          <div class="form-group">
            <label>å¯†ç </label>
            <input type="password" id="webdavPassword">
          </div>
          <div class="form-group">
            <label>å¤‡ä»½æ–‡ä»¶å</label>
            <input type="text" id="webdavFilename" value="nav_backup.json">
            <div class="form-hint" style="color: #666;">
              å»ºè®®ä¿æŒé»˜è®¤æ–‡ä»¶åï¼Œä»¥å…æ¢å¤æ—¶æ‰¾ä¸åˆ°å¤‡ä»½æ–‡ä»¶
            </div>
          </div>
          <div class="settings-buttons">
            <button class="settings-button" id="backupToWebDAVBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              <span>å¤‡ä»½åˆ° WebDAV</span>
            </button>
            <button class="settings-button" id="restoreFromWebDAVBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              <span>ä» WebDAV æ¢å¤</span>
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-button cancel-button" id="closeSettingsButton">å…³é—­</button>
      </div>
    </div>
  </div>

  <!-- æ·»åŠ æœç´¢å¼•æ“å¼¹çª— -->
  <div class="modal" id="addEngineModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>æ·»åŠ æœç´¢å¼•æ“</h3>
      </div>
      <div class="form-group">
        <label>åç§°</label>
        <input type="text" id="engineName" placeholder="ä¾‹å¦‚ï¼šGoogle">
      </div>
      <div class="form-group">
        <label>æœç´¢ URL</label>
        <input type="text" id="engineUrl" placeholder="ä¾‹å¦‚ï¼šhttps://www.google.com/search?q={q}">
        <div class="form-hint">ä½¿ç”¨ {q} è¡¨ç¤ºæœç´¢å…³é”®è¯çš„ä½ç½®</div>
      </div>
      <div class="modal-footer">
        <button class="modal-button cancel-button" id="cancelEngineButton">å–æ¶ˆ</button>
        <button class="modal-button save-button" id="saveEngineButton">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- æ·»åŠ åˆ†ç»„ç®¡ç†å¼¹çª— -->
  <div class="modal" id="categoryModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>åˆ†ç»„ç®¡ç†</h3>
      </div>
      <div class="categories-section">
        <div class="categories-list-wrapper">
          <div class="categories-list">
            <!-- åˆ†ç»„åˆ—è¡¨å°†ç”± JavaScript åŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
        <button class="settings-button add-button" id="addNewCategoryBtn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          <span>æ·»åŠ åˆ†ç»„</span>
        </button>
      </div>
      <div class="modal-footer">
        <button class="modal-button cancel-button" id="closeCategoryModal">å…³é—­</button>
      </div>
    </div>
  </div>

  <!-- æ·»åŠ /ç¼–è¾‘åˆ†ç»„å¼¹çª— -->
  <div class="modal" id="editCategoryModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="editCategoryTitle">æ·»åŠ åˆ†ç»„</h3>
      </div>
      <div class="form-group">
        <label>åˆ†ç»„åç§°</label>
        <input type="text" id="categoryName" placeholder="è¾“å…¥åˆ†ç»„åç§°">
        <input type="hidden" id="categoryId">
      </div>
      <div class="modal-footer">
        <button class="modal-button cancel-button" id="cancelCategoryButton">å–æ¶ˆ</button>
        <button class="modal-button save-button" id="saveCategoryButton">ä¿å­˜</button>
      </div>
    </div>
  </div>
</body>

</html>